<!-- Breadcrumb for navigation -->
<app-breadcrumb [breadcrumbs]="breadcrumbs"></app-breadcrumb>

<!-- Button to create a task -->
<div class="flex flex-row gap-4">
  <div>
    <button (click)="openTaskModal()" 
            type="button" 
            class="text-orange-600 border-1 border-indigo-100 hover:text-indigo-600 hover:bg-indigo-100 font-medium rounded-2xl text-sm px-3 py-2.5 text-center inline-flex items-center me-2 mb-2">
      <svg xmlns="http://www.w3.org/2000/svg" 
           width="24" 
           height="24" 
           viewBox="0 0 24 24" 
           fill="none" 
           stroke="currentColor" 
           stroke-width="2" 
           stroke-linecap="round" 
           stroke-linejoin="round" 
           class="icon icon-tabler icons-tabler-outline icon-tabler-clipboard-plus">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"/>
        <path d="M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z"/>
        <path d="M10 14h4"/>
        <path d="M12 12v4"/>
      </svg>
      <span class="ml-2">Créer une tâche</span>
    </button>
    <!-- Modal to create a task -->
    <app-task-modal [isModalOpen]="isTaskModalOpen" (closeModal)="closeTaskModal()" (taskCreated)="onTaskCreated()"></app-task-modal>
  </div>
</div>

<!-- Task list with drag-and-drop support -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 bg-slate-100 p-4 rounded-xl">

  <!-- TODO Section -->
  <div class="ring-1 ring-pink-500 ring-inset rounded-xl p-4" 
       dndDropzone 
       (dndDrop)="onTaskDrop($event, 'TODO')">
    <span class="text-xl font-semibold text-pink-500">À FAIRE</span>
    <div class="pt-4 flex flex-col gap-4">
      <!-- TASK TO DO -->
      <div *ngFor="let task of tasksTodo" 
           dndDraggable 
           [dndDraggable]="task" 
           class="todo-task-cursor max-w-sm p-4 flex flex-col justify-between bg-white/50 border border-gray-200 rounded-2xl shadow-sm cursor-pointer transition-all duration-300 overflow-hidden relative">
        <div>
          <div class="text-right text-sm text-gray-500">Date limite : <span class="text-indigo-600">{{ task.dueDate | date }}</span></div>
          <div class="flex flex-row gap-2 items-center text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" 
                 width="24" 
                 height="24" 
                 viewBox="0 0 24 24" 
                 fill="none" 
                 stroke="currentColor" 
                 stroke-width="2" 
                 stroke-linecap="round" 
                 stroke-linejoin="round" 
                 class="icon icon-tabler icons-tabler-checklist">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M9.615 20h-2.615a2 2 0 0 1-2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8"/>
              <path d="M14 19l2 2l4 -4"/>
              <path d="M9 8h4"/>
              <path d="M9 12h2"/>
            </svg>
            <h5 class="mb-2 pt-2 text-lg font-medium tracking-tight">{{ task.name }}</h5>
          </div>
        </div>
        <div class="description">
          <p class="mb-3 font-normal text-sm text-gray-500">{{ task.description }}</p>
        </div>
        <div class="bg-indigo-50 p-2 rounded-lg mt-2">
          <p class="text-sm text-gray-600">Projet : <span class="text-indigo-600">{{ task.project?.name }}</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- IN PROGRESS SECTION -->
  <div class="ring-1 ring-orange-500 ring-inset rounded-xl p-4" 
       dndDropzone 
       (dndDrop)="onTaskDrop($event, 'IN_PROGRESS')">
    <span class="text-xl font-semibold text-orange-500">EN COURS</span>
    <div class="pt-4 flex flex-col gap-4">
      <div *ngFor="let task of tasksInProgress" 
           dndDraggable 
           [dndDraggable]="task" 
           class="progress-task-cursor max-w-sm p-4 flex flex-col justify-between bg-white/50 border border-gray-200 rounded-2xl shadow-sm cursor-pointer transition-all duration-300 overflow-hidden relative">
        <div>
          <div class="text-right text-sm text-gray-500">Date limite : <span class="text-indigo-600">{{ task.dueDate | date }}</span></div>
          <div class="flex flex-row gap-2 items-center text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" 
                 width="24" 
                 height="24" 
                 viewBox="0 0 24 24" 
                 fill="none" 
                 stroke="currentColor" 
                 stroke-width="2" 
                 stroke-linecap="round" 
                 stroke-linejoin="round" 
                 class="icon icon-tabler icons-tabler-checklist">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M9.615 20h-2.615a2 2 0 0 1-2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8"/>
              <path d="M14 19l2 2l4 -4"/>
              <path d="M9 8h4"/>
              <path d="M9 12h2"/>
            </svg>
            <h5 class="mb-2 pt-2 text-lg font-medium tracking-tight">{{ task.name }}</h5>
          </div>
        </div>
        <div class="description">
          <p class="mb-3 font-normal text-sm text-gray-500">{{ task.description }}</p>
        </div>
        <div class="bg-indigo-50 p-2 rounded-lg mt-2">
          <p class="text-sm text-gray-600">Projet : <span class="text-indigo-600">{{ task.project?.name }}</span></p>
        </div>
      </div>
    </div>
  </div>

  <!-- COMPLETED SECTION -->
  <div class="ring-1 ring-indigo-500 ring-inset rounded-xl p-4" 
       dndDropzone 
       (dndDrop)="onTaskDrop($event, 'COMPLETED')">
    <span class="text-xl font-semibold text-indigo-600">TERMINÉ</span>
    <div class="pt-4 flex flex-col gap-4">
      <div *ngFor="let task of tasksCompleted" 
           dndDraggable 
           [dndDraggable]="task" 
           class="completed-task-cursor max-w-sm p-4 flex flex-col justify-between bg-white/50 border border-gray-200 rounded-2xl shadow-sm cursor-pointer transition-all duration-300 overflow-hidden relative">
        <div>
          <div class="text-right text-sm text-gray-500">Date limite : <span class="text-indigo-600">{{ task.dueDate | date }}</span></div>
          <div class="flex flex-row gap-2 items-center text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg" 
                 width="24" 
                 height="24" 
                 viewBox="0 0 24 24" 
                 fill="none" 
                 stroke="currentColor" 
                 stroke-width="2" 
                 stroke-linecap="round" 
                 stroke-linejoin="round" 
                 class="icon icon-tabler icons-tabler-checklist">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M9.615 20h-2.615a2 2 0 0 1-2 -2v-12a2 2 0 0 1 2 -2h8a2 2 0 0 1 2 2v8"/>
              <path d="M14 19l2 2l4 -4"/>
              <path d="M9 8h4"/>
              <path d="M9 12h2"/>
            </svg>
            <h5 class="mb-2 pt-2 text-lg font-medium tracking-tight">{{ task.name }}</h5>
          </div>
        </div>
        <div class="description">
          <p class="mb-3 font-normal text-sm text-gray-500">{{ task.description }}</p>
        </div>
        <div class="bg-indigo-50 p-2 rounded-lg mt-2">
          <p class="text-sm text-gray-600">Projet : <span class="text-indigo-600">{{ task.project?.name }}</span></p>
        </div>
      </div>
    </div>
  </div>

</div>
